@model Ecommerce.Web.ViewModels.CategoryViewModel

@{
    ViewData["Title"] = Model.Name;
}

<section class="category-hero-card">
    <div>
        <nav aria-label="breadcrumb" class="breadcrumb-bar">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
                <li class="breadcrumb-item active" aria-current="page">@Model.Name</li>
            </ol>
        </nav>
        <p class="pill">Danh mục</p>
        <h1>@Model.Name</h1>
        @if (!string.IsNullOrWhiteSpace(Model.Description))
        {
            <p class="muted">@Model.Description</p>
        }
        <div class="category-meta">
            <span class="category-chip">@Model.ProductCount sản phẩm</span>
        </div>
    </div>
    </div>
</section>

<section class="section">
    <form method="get" class="filter-bar">
        <input type="hidden" name="id" value="@Model.Id" />
        <div class="filter-group">
            <label class="small fw-bold">Tìm kiếm</label>
            <input name="search" value="@Model.SearchTerm" placeholder="Tìm theo tên..." />
        </div>
        <div class="filter-group">
            <label class="small fw-bold">Giá từ</label>
            <input name="minPrice" type="number" value="@Model.MinPrice" placeholder="0" />
        </div>
        <div class="filter-group">
            <label class="small fw-bold">Giá đến</label>
            <input name="maxPrice" type="number" value="@Model.MaxPrice" placeholder="Max" />
        </div>
        <div class="filter-group" style="align-self: flex-end;">
            <button type="submit" class="btn btn-primary">Lọc sản phẩm</button>
        </div>
    </form>
</section>

<section class="catalog-grid">
    @if (Model.Products.Any())
    {
        @foreach (var product in Model.Products)
        {
            <article class="product-card @(product.IsFeatured ? "featured" : string.Empty)">
                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.Id" class="product-link">
                    <img src="@product.HeroImageUrl" alt="@product.Name" loading="lazy" />
                    <div class="card-body">
                        <p class="eyebrow">Sản phẩm</p>
                        <h3>@product.Name</h3>
                        <p>@product.Description</p>
                        <div class="card-footer">
                            <div class="price-section">
                                @if (product.OriginalPrice.HasValue && product.OriginalPrice.Value > 0 && product.OriginalPrice.Value > product.Price)
                                {
                                    <div class="product-price-original" style="text-decoration: line-through; color: #999; font-size: 0.9em;">
                                        @product.OriginalPrice.Value.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-weight: bold; color: #e74c3c;">
                                            @product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                        </span>
                                        @{
                                            var discount = Math.Round(100 * (-1 + (double)product.Price / (double)product.OriginalPrice.Value));
                                        }
                                        <span style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.85em; font-weight: bold;">
                                            @discount%
                                        </span>
                                    </div>
                                }
                                else
                                {
                                    <span style="font-weight: bold;">@product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</span>
                                }
                            </div>
                            <div class="add-to-cart-group">
                                <input type="number" id="qty-@product.Id" value="1" min="1" max="10" class="qty-input" onclick="event.stopPropagation();" />
                                <button class="btn-add-cart" onclick="event.preventDefault(); event.stopPropagation(); addToCart('@product.Id', document.getElementById('qty-@product.Id').value)">
                                    Thêm vào giỏ
                                </button>
                            </div>
                        </div>
                    </div>
                </a>
            </article>
        }
    }
    else
    {
        <div class="col-12 text-center py-5">
            <p class="text-muted">Chưa có sản phẩm nào trong danh mục này.</p>
            <a asp-controller="Home" asp-action="Index" class="btn btn-primary mt-3">Về trang chủ</a>
        </div>
    }
</section>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Category pagination" class="pagination-modern">
        <a class="pager-btn @(Model.HasPreviousPage ? "" : "disabled")"
           asp-action="Index" asp-route-id="@Model.Id" asp-route-pageNumber="@(Model.PageIndex - 1)">
            <i class="bi bi-chevron-left"></i> Trước
        </a>
        <span class="pager-current">Trang @Model.PageIndex / @Model.TotalPages</span>
        <a class="pager-btn @(Model.HasNextPage ? "" : "disabled")"
           asp-action="Index" asp-route-id="@Model.Id" asp-route-pageNumber="@(Model.PageIndex + 1)">
            Sau <i class="bi bi-chevron-right"></i>
        </a>
    </nav>
}
