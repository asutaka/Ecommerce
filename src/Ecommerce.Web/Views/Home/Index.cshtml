@model Ecommerce.Web.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "Moderno Living";
    var status = ViewBag.CheckoutStatus as string;
    var heroProduct = Model.FeaturedProducts.FirstOrDefault();
}

<section class="hero-panel">
    <div class="hero-copy">
        <p class="eyebrow">Tinh thần Moderno</p>
        <h1>Không gian sống <span>tối giản</span> và cảm hứng.</h1>
        <p class="lede">
            Bộ sưu tập curated từ studio Moderno lấy cảm hứng từ template Moderno mà bạn yêu thích.
            Chúng tôi kết hợp chất liệu tự nhiên, ánh sáng và hình khối kiến trúc đương đại.
        </p>
        <div class="hero-cta">
            <a class="primary" href="#catalog">Khám phá catalog</a>
            <a class="ghost" asp-area="Admin" asp-controller="Dashboard" asp-action="Index">Xem dashboard</a>
        </div>
    </div>
    <div class="hero-media">
        <div class="media-card">
            <img src="@heroProduct?.HeroImageUrl" alt="@heroProduct?.Name" />
            <div class="media-meta">
                <span>@heroProduct?.Name</span>
                <strong>@heroProduct?.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</strong>
            </div>
        </div>
    </div>
</section>

@if (!string.IsNullOrWhiteSpace(status))
{
    <div class="alert @(status == "success" ? "alert-success" : "alert-danger")">
        @(status == "success" ? "Đơn hàng đã được gửi vào saga MassTransit." : "Vui lòng kiểm tra thông tin và thử lại.")
    </div>
}

<!-- Featured Categories Section -->
@if (Model.FeaturedCategories.Any())
{
    <section class="categories-section my-5">
        <div class="container-fluid px-0">
            <h2 class="text-center mb-4">Danh mục sản phẩm</h2>
            <div class="row g-3">
                @foreach (var category in Model.FeaturedCategories)
                {
                    <div class="col-md-4 col-lg-2">
                        <a asp-controller="Category" asp-action="Index" asp-route-id="@category.Id" class="category-card text-decoration-none">
                            <div class="card h-100 bg-transparent border-secondary text-center">
                                <div class="card-body">
                                    <h5 class="card-title">@category.Name</h5>
                                    <p class="card-text text-muted small">@category.ProductCount sản phẩm</p>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    </section>
}

<!-- Statistics Section -->
<section class="statistics-section my-5 py-4 bg-dark bg-opacity-10">
    <div class="container-fluid px-0">
        <div class="row text-center">
            <div class="col-md-4">
                <h3 class="display-4 fw-bold">@Model.Statistics.TotalProducts</h3>
                <p class="text-muted">Sản phẩm</p>
            </div>
            <div class="col-md-4">
                <h3 class="display-4 fw-bold">@Model.Statistics.TotalCategories</h3>
                <p class="text-muted">Danh mục</p>
            </div>
            <div class="col-md-4">
                <h3 class="display-4 fw-bold">@Model.Statistics.TotalOrders</h3>
                <p class="text-muted">Đơn hàng</p>
            </div>
        </div>
    </div>
</section>

<section id="catalog" class="catalog-grid">
    @foreach (var product in Model.FeaturedProducts)
    {
        <article class="product-card @(product.IsFeatured ? "featured" : string.Empty)">
            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.Id" class="product-link text-decoration-none">
                <img src="@product.HeroImageUrl" alt="@product.Name" loading="lazy" />
                <div class="card-body">
                    <p class="eyebrow">Sản phẩm</p>
                    <h3>@product.Name</h3>
                    <p>@product.Description</p>
                    <div class="card-footer">
                        <span>@product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</span>
                        <div class="add-to-cart-group">
                            <input type="number" id="qty-@product.Id" value="1" min="1" max="10" class="qty-input" onclick="event.stopPropagation();" />
                            <button class="btn-add-cart" onclick="event.preventDefault(); event.stopPropagation(); addToCart('@product.Id', document.getElementById('qty-@product.Id').value)">
                                Thêm vào giỏ
                            </button>
                        </div>
                    </div>
                </div>
            </a>
        </article>
    }
</section>

<section class="checkout-panel" id="checkout">
    <div>
        <p class="eyebrow">Đặt thiết kế riêng</p>
        <h2>Tạo hóa đơn và kích hoạt Saga thanh toán</h2>
        <p>Form này sẽ publish message <code>CreateInvoice</code> lên RabbitMQ để khởi chạy chuỗi Saga (invoice → payment → notify).</p>
    </div>
    <form asp-controller="Orders" asp-action="Checkout" method="post" class="checkout-form">
        @Html.AntiForgeryToken()
        <div class="form-group">
            <label asp-for="Checkout.CustomerName"></label>
            <input asp-for="Checkout.CustomerName" />
            <span asp-validation-for="Checkout.CustomerName"></span>
        </div>
        <div class="form-group">
            <label asp-for="Checkout.CustomerEmail"></label>
            <input asp-for="Checkout.CustomerEmail" />
            <span asp-validation-for="Checkout.CustomerEmail"></span>
        </div>
        <div class="form-group">
            <label asp-for="Checkout.ProductId">Chọn sản phẩm</label>
            <select asp-for="Checkout.ProductId" asp-items="@(new SelectList(Model.FeaturedProducts, nameof(ProductViewModel.Id), nameof(ProductViewModel.Name)))"></select>
        </div>
        <div class="form-group">
            <label asp-for="Checkout.Quantity"></label>
            <input asp-for="Checkout.Quantity" type="number" min="1" max="10" />
        </div>
        <button type="submit">Khởi tạo hóa đơn</button>
    </form>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
