@model Ecommerce.Web.ViewModels.CartViewModel

@{
    ViewData["Title"] = "Gi·ªè h√†ng";
}

<style>
    .checkout-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
    }
    
    .checkout-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #1f2937;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-group label {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 6px;
        color: #374151;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .cart-items-container {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .cart-item-new {
        display: grid;
        grid-template-columns: auto 80px 1fr auto;
        gap: 16px;
        padding: 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        align-items: center;
    }
    
    .cart-item-new:hover {
        background: #f9fafb;
    }
    
    .item-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    
    .item-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }
    
    .item-info {
        flex: 1;
    }
    
    .item-name {
        font-weight: 600;
        margin-bottom: 8px;
        color: #1f2937;
    }
    
    .item-variants {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
    }
    
    .variant-select {
        padding: 6px 10px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 13px;
        background: white;
    }
    
    .item-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .qty-controls {
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 4px;
    }
    
    .qty-btn {
        width: 28px;
        height: 28px;
        border: none;
        background: #f3f4f6;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .qty-btn:hover {
        background: #e5e7eb;
    }
    
    .qty-value {
        min-width: 30px;
        text-align: center;
        font-weight: 500;
    }
    
    .item-price {
        text-align: right;
    }
    
    .price-current {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
    }
    
    .price-original {
        font-size: 13px;
        color: #9ca3af;
        text-decoration: line-through;
    }
    
    .item-remove {
        background: none;
        border: none;
        color: #ef4444;
        cursor: pointer;
        padding: 8px;
        font-size: 18px;
    }
    
    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .summary-row:last-child {
        border-bottom: none;
    }
    
    .summary-row.total {
        font-size: 18px;
        font-weight: 600;
        padding-top: 16px;
        border-top: 2px solid #1f2937;
    }
    
    .payment-option {
        display: flex;
        align-items: center;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        cursor: pointer;
    }
    
    .payment-option:hover {
        border-color: #3b82f6;
        background: #eff6ff;
    }
    
    .payment-option input[type="radio"] {
        width: 20px;
        height: 20px;
        margin-right: 12px;
    }
    
    .btn-checkout {
        width: 100%;
        padding: 16px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .btn-checkout:hover {
        background: #2563eb;
    }
    
    .select-all-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: #f9fafb;
        border-radius: 8px;
        margin-bottom: 16px;
    }
    
    .select-all-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }
    
    .btn-clear-all {
        color: #ef4444;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
    }
</style>

<div class="checkout-container">
    <h1 style="margin-bottom: 30px;">Gi·ªè h√†ng</h1>
    
    @if (Model.Items.Any())
    {
        <form method="post" asp-action="Checkout">
            <!-- 1. TH√îNG TIN V·∫¨N CHUY·ªÇN -->
            <div class="checkout-section">
                <h2 class="section-title">Th√¥ng tin v·∫≠n chuy·ªÉn</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>H·ªç t√™n *</label>
                        <input type="text" name="CustomerName" value="@Model.CustomerName" placeholder="Nh·∫≠p h·ªç t√™n c·ªßa b·∫°n" required />
                    </div>
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
                        <input type="tel" name="CustomerPhone" value="@Model.CustomerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required />
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 16px;">
                    <label>Email *</label>
                    <input type="email" name="CustomerEmail" value="@Model.CustomerEmail" placeholder="Nh·∫≠p email c·ªßa b·∫°n" required />
                </div>
                
                <div class="form-group" style="margin-bottom: 16px;">
                    <label>ƒê·ªãa ch·ªâ giao h√†ng *</label>
                    @if (Model.AvailableAddresses.Any())
                    {
                        <select name="ShippingAddress" class="form-control" required style="padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                            @foreach (var address in Model.AvailableAddresses)
                            {
                                <option value="@address" selected="@(address == Model.ShippingAddress)">@address</option>
                            }
                            <option value="">Nh·∫≠p ƒë·ªãa ch·ªâ kh√°c...</option>
                        </select>
                        <input type="text" id="customAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ m·ªõi" style="margin-top: 8px; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; width: 100%; display: none;" />
                    }
                    else
                    {
                        <input type="text" name="ShippingAddress" value="@Model.ShippingAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng" required />
                    }
                </div>
                
                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <textarea name="Note" rows="3" placeholder="Ghi ch√∫ cho ƒë∆°n h√†ng (t√πy ch·ªçn)"></textarea>
                </div>
            </div>
            
            <!-- 2. GI·ªé H√ÄNG -->
            <div class="checkout-section">
                <h2 class="section-title">Gi·ªè h√†ng</h2>
                
                <div class="select-all-row">
                    <label class="select-all-label">
                        <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" />
                        <span>T·∫•t c·∫£ s·∫£n ph·∫©m (@Model.Items.Count)</span>
                    </label>
                    <button type="button" class="btn-clear-all" onclick="clearAll()">X√≥a t·∫•t c·∫£</button>
                </div>
                
                <div class="cart-items-container">
                    @foreach (var item in Model.Items)
                    {
                        <div class="cart-item-new" data-item-id="@item.Id">
                            <input type="checkbox" class="item-checkbox" checked />
                            
                            <img src="@item.ProductImageUrl" alt="@item.ProductName" class="item-image" />
                            
                            <div class="item-info">
                                <div class="item-name">@item.ProductName</div>
                                
                                @if (!string.IsNullOrEmpty(item.VariantColor) || !string.IsNullOrEmpty(item.VariantSize))
                                {
                                    <div class="item-variants">
                                        @if (!string.IsNullOrEmpty(item.VariantColor))
                                        {
                                            <select class="variant-select">
                                                <option selected>@item.VariantColor</option>
                                            </select>
                                        }
                                        @if (!string.IsNullOrEmpty(item.VariantSize))
                                        {
                                            <select class="variant-select">
                                                <option selected>@item.VariantSize</option>
                                            </select>
                                        }
                                    </div>
                                }
                                
                                <div class="item-controls">
                                    <div class="qty-controls">
                                        <button type="button" class="qty-btn" onclick="updateQuantity('@item.Id', @(item.Quantity - 1))">‚àí</button>
                                        <span class="qty-value">@item.Quantity</span>
                                        <button type="button" class="qty-btn" onclick="updateQuantity('@item.Id', @(item.Quantity + 1))">+</button>
                                    </div>
                                    <button type="button" class="item-remove" onclick="removeItem('@item.Id')" title="X√≥a">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            
                            <div class="item-price">
                                @if (item.OriginalPrice.HasValue && item.OriginalPrice.Value > 0 && item.OriginalPrice.Value > item.UnitPrice)
                                {
                                    <div class="price-original">@((item.OriginalPrice.Value * item.Quantity).ToString("N0"))ƒë</div>
                                }
                                <div class="price-current">@item.LineTotal.ToString("N0")ƒë</div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <!-- 3. CH·ªåN COUPON -->
            <div class="checkout-section">
                <h2 class="section-title">M√£ gi·∫£m gi√°</h2>
                
                @if (string.IsNullOrEmpty(Model.AppliedCouponCode))
                {
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="couponCodeInput" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" 
                               style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px;" />
                        <button type="button" onclick="applyCoupon()" 
                                style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            √Åp d·ª•ng
                        </button>
                    </div>
                }
                else
                {
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="color: #10b981;">‚úì</span>
                            <span style="font-weight: 600; color: #065f46;">@Model.AppliedCouponCode</span>
                            <span style="color: #059669;">- Gi·∫£m @Model.Discount.ToString("N0")ƒë</span>
                        </div>
                        <button type="button" onclick="removeCoupon()" style="background: none; border: none; color: #6b7280; cursor: pointer;">
                            ‚úï
                        </button>
                    </div>
                }
            </div>
            
            <!-- 4. CHI TI·∫æT THANH TO√ÅN -->
            <div class="checkout-section">
                <h2 class="section-title">Chi ti·∫øt thanh to√°n</h2>
                
                <div class="summary-row">
                    <span>T·∫°m t√≠nh</span>
                    <strong id="subtotal">@Model.Subtotal.ToString("N0")ƒë</strong>
                </div>
                
                @if (Model.Discount > 0)
                {
                    <div class="summary-row" style="color: #10b981;">
                        <span>Gi·∫£m gi√°</span>
                        <strong id="discount">-@Model.Discount.ToString("N0")ƒë</strong>
                    </div>
                }
                
                <div class="summary-row">
                    <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                    <strong id="shippingFee">@Model.ShippingFee.ToString("N0")ƒë</strong>
                </div>
                
                <div class="summary-row total">
                    <span>T·ªïng c·ªông</span>
                    <strong id="total">@Model.Total.ToString("N0")ƒë</strong>
                </div>
            </div>
            
            <!-- 5. H√åNH TH·ª®C THANH TO√ÅN -->
            <div class="checkout-section">
                <h2 class="section-title">H√¨nh th·ª©c thanh to√°n</h2>
                
                <label class="payment-option">
                    <input type="radio" name="PaymentMethod" value="COD" checked />
                    <div>
                        <div style="font-weight: 600;">Thanh to√°n khi nh·∫≠n h√†ng (COD)</div>
                        <div style="font-size: 13px; color: #6b7280;">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</div>
                    </div>
                </label>
                
                <label class="payment-option">
                    <input type="radio" name="PaymentMethod" value="Banking" />
                    <div>
                        <div style="font-weight: 600;">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
                        <div style="font-size: 13px; color: #6b7280;">Chuy·ªÉn kho·∫£n qua Internet Banking</div>
                    </div>
                </label>
                
                <label class="payment-option">
                    <input type="radio" name="PaymentMethod" value="EWallet" />
                    <div>
                        <div style="font-weight: 600;">V√≠ ƒëi·ªán t·ª≠</div>
                        <div style="font-size: 13px; color: #6b7280;">MoMo, ZaloPay, VNPay</div>
                    </div>
                </label>
            </div>
            
            <!-- 6. ƒê·∫∂T H√ÄNG -->
            <div class="checkout-section">
                <button type="submit" class="btn-checkout">
                    ƒê·∫∂T H√ÄNG NGAY
                </button>
            </div>
        </form>
    }
    else
    {
        <div class="checkout-section" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üõí</div>
            <h3>Gi·ªè h√†ng tr·ªëng</h3>
            <p style="color: #6b7280; margin-bottom: 24px;">B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng</p>
            <a href="@Url.Action("Index", "Home")" class="btn-checkout" style="display: inline-block; width: auto; padding: 12px 32px; text-decoration: none;">
                Ti·∫øp t·ª•c mua s·∫Øm
            </a>
        </div>
    }
</div>

<script>
    function toggleSelectAll(checkbox) {
        const itemCheckboxes = document.querySelectorAll('.item-checkbox');
        itemCheckboxes.forEach(cb => cb.checked = checkbox.checked);
    }
    
    function clearAll() {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ s·∫£n ph·∫©m?')) {
            window.location.href = '@Url.Action("Clear", "Cart")';
        }
    }
</script>

@section Scripts {
    <script src="~/js/cart.js"></script>
}
